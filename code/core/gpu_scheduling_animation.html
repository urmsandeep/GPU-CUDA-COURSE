<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU Kernel Scheduling Animation</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #root {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Lucide React Icons as inline SVG components
        const ChevronLeft = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        );

        const ChevronRight = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const RotateCcw = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
        );

        const Zap = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
            </svg>
        );

        const Cpu = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
                <rect x="9" y="9" width="6" height="6"></rect>
                <line x1="9" y1="1" x2="9" y2="4"></line>
                <line x1="15" y1="1" x2="15" y2="4"></line>
                <line x1="9" y1="20" x2="9" y2="23"></line>
                <line x1="15" y1="20" x2="15" y2="23"></line>
                <line x1="20" y1="9" x2="23" y2="9"></line>
                <line x1="20" y1="14" x2="23" y2="14"></line>
                <line x1="1" y1="9" x2="4" y2="9"></line>
                <line x1="1" y1="14" x2="4" y2="14"></line>
            </svg>
        );

        const GPUSchedulingAnimation = () => {
            const [step, setStep] = useState(0);

            // Kernel configuration: 6 blocks, 8 threads per block
            const NUM_BLOCKS = 6;
            const THREADS_PER_BLOCK = 8;
            const NUM_SMS = 4;
            const CORES_PER_SM = 8;

            const steps = [
                { 
                    title: "Step 0: Initial State", 
                    desc: "CPU prepares to launch kernel",
                    explanation: "Your program is running on the CPU. You've written a CUDA kernel and are about to call it with <<<6, 8>>> configuration. This means you want 6 blocks, each containing 8 threads. The GPU is idle, waiting for work."
                },
                { 
                    title: "Step 1: Kernel Launch", 
                    desc: "kernel<<<6, 8>>>() called",
                    explanation: "The CPU executes the kernel launch command. This sends a request to the GPU driver to start executing your kernel function. The 6 blocks (Block 0 through Block 5) are now queued and ready to be distributed to the GPU's Streaming Multiprocessors."
                },
                { 
                    title: "Step 2: Block Distribution", 
                    desc: "Hardware scheduler assigns blocks to SMs",
                    explanation: "The GPU's hardware scheduler (the 'Gigathread Engine') distributes your 6 blocks across the 4 available SMs using a round-robin strategy. Notice how blocks are color-coded to show which SM they're assigned to: Block 0‚ÜíSM0, Block 1‚ÜíSM1, Block 2‚ÜíSM2, Block 3‚ÜíSM3, Block 4‚ÜíSM0, Block 5‚ÜíSM1. Multiple blocks can be assigned to the same SM!"
                },
                { 
                    title: "Step 3: Thread Scheduling", 
                    desc: "Each SM schedules threads onto CUDA cores",
                    explanation: "Inside each SM, the warp scheduler organizes the 8 threads from each assigned block into warps (groups of 32 threads, but our blocks are smaller). The scheduler prepares to dispatch these threads to the SM's 8 CUDA cores. Remember: threads in a warp execute the SAME instruction at the SAME time (SIMT model)."
                },
                { 
                    title: "Step 4: Parallel Execution", 
                    desc: "All threads execute simultaneously!",
                    explanation: "üî• THIS IS WHERE THE MAGIC HAPPENS! All 4 SMs are now executing in parallel. Each CUDA core is processing one thread. The lightning bolts (‚ö°) show active computation. Since we have 8 threads per block but only 8 cores per SM, threads execute in waves. All 48 threads (6 blocks √ó 8 threads) are running at the same time across all SMs - this is true parallelism!"
                },
                { 
                    title: "Step 5: Complete", 
                    desc: "Execution finished, results in GPU memory",
                    explanation: "All threads have completed their work! The results are now stored in the GPU's global memory. Your CPU code would typically call cudaMemcpy() to transfer these results back to CPU memory for further processing. The GPU is now idle again, ready for the next kernel launch."
                }
            ];

            const nextStep = () => {
                if (step < steps.length - 1) {
                    setStep(step + 1);
                }
            };

            const prevStep = () => {
                if (step > 0) {
                    setStep(step - 1);
                }
            };

            const reset = () => {
                setStep(0);
            };

            // Determine which blocks are assigned to which SM
            const getBlockAssignment = (blockId) => {
                if (step < 2) return null;
                return blockId % NUM_SMS;
            };

            // Determine if a thread is active
            const isThreadActive = (blockId, threadId) => {
                return step >= 4;
            };

            const smColors = [
                { border: 'border-green-400', bg: 'bg-green-500', bgDark: 'bg-green-600', glow: 'rgba(34,197,94,0.5)' },
                { border: 'border-blue-400', bg: 'bg-blue-500', bgDark: 'bg-blue-600', glow: 'rgba(59,130,246,0.5)' },
                { border: 'border-yellow-400', bg: 'bg-yellow-500', bgDark: 'bg-yellow-600', glow: 'rgba(234,179,8,0.5)' },
                { border: 'border-pink-400', bg: 'bg-pink-500', bgDark: 'bg-pink-600', glow: 'rgba(236,72,153,0.5)' }
            ];

            return (
                <div className="w-full min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 text-white flex flex-col p-6">
                    <div className="text-center mb-6">
                        <h1 className="text-4xl font-bold mb-2 bg-gradient-to-r from-green-400 to-blue-400 bg-clip-text text-transparent">
                            GPU Kernel Scheduling
                        </h1>
                        <p className="text-lg text-gray-300">How Blocks & Threads Map to Physical Hardware</p>
                    </div>

                    {/* Current Step Display */}
                    <div className="bg-gray-800 rounded-xl p-4 mb-4 border-2 border-blue-500 shadow-lg">
                        <div className="flex items-center justify-between">
                            <div>
                                <div className="text-xl font-bold text-blue-400">{steps[step].title}</div>
                                <div className="text-gray-300 text-sm mt-1">{steps[step].desc}</div>
                            </div>
                            <div className="text-5xl">
                                {step === 0 && "üíª"}
                                {step === 1 && "üöÄ"}
                                {step === 2 && "üì¶"}
                                {step === 3 && "‚öôÔ∏è"}
                                {step === 4 && "‚ö°"}
                                {step === 5 && "‚úÖ"}
                            </div>
                        </div>
                    </div>

                    {/* Detailed Explanation Box */}
                    <div className="bg-gradient-to-r from-yellow-900 to-orange-900 rounded-xl p-4 mb-4 border-2 border-yellow-500 shadow-lg">
                        <div className="flex items-start gap-3">
                            <div className="text-3xl">üìñ</div>
                            <div className="flex-1">
                                <div className="text-lg font-bold text-yellow-300 mb-2">What's Happening:</div>
                                <div className="text-gray-100 text-sm leading-relaxed">
                                    {steps[step].explanation}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Left: Logical View (Kernel) */}
                        <div className="bg-gray-800 rounded-xl p-4 border-2 border-purple-500 shadow-lg">
                            <div className="flex items-center gap-2 mb-3">
                                <Cpu className="w-6 h-6 text-purple-400" />
                                <h2 className="text-xl font-bold text-purple-400">Logical View: Your Kernel</h2>
                            </div>
                            
                            <div className="bg-gray-900 rounded-lg p-3 mb-3 font-mono text-green-400 text-xs">
                                kernel&lt;&lt;&lt;{NUM_BLOCKS}, {THREADS_PER_BLOCK}&gt;&gt;&gt;();
                            </div>

                            {step === 0 && (
                                <div className="bg-gray-700 rounded-lg p-8 text-center border-2 border-dashed border-gray-600">
                                    <div className="text-4xl mb-3">‚è≥</div>
                                    <div className="text-gray-400 text-sm">
                                        Waiting for kernel launch...<br/>
                                        Click "Next Step" to begin execution
                                    </div>
                                </div>
                            )}

                            <div className="space-y-2">
                                {[...Array(NUM_BLOCKS)].map((_, blockId) => {
                                    const assignedSM = getBlockAssignment(blockId);
                                    const color = assignedSM !== null ? smColors[assignedSM] : null;
                                    return (
                                        <div 
                                            key={blockId}
                                            className={`bg-gray-700 rounded-lg p-2 border-2 transition-all duration-500 ${
                                                color ? `${color.border} animate-pulse` : 'border-gray-600'
                                            }`}
                                            style={{
                                                opacity: step === 0 ? 0.3 : 1,
                                                transform: assignedSM !== null ? 'scale(1.02)' : 'scale(1)',
                                                display: step === 0 ? 'none' : 'block'
                                            }}
                                        >
                                            <div className="flex items-center justify-between mb-2">
                                                <span className="font-bold text-purple-300 text-sm">Block {blockId}</span>
                                                {assignedSM !== null && (
                                                    <span className="text-xs bg-blue-600 px-2 py-1 rounded">‚Üí SM {assignedSM}</span>
                                                )}
                                            </div>
                                            <div className="flex gap-1 flex-wrap">
                                                {[...Array(THREADS_PER_BLOCK)].map((_, threadId) => (
                                                    <div
                                                        key={threadId}
                                                        className={`w-6 h-6 rounded flex items-center justify-center text-xs transition-all duration-300 ${
                                                            isThreadActive(blockId, threadId)
                                                                ? 'bg-green-500 animate-pulse'
                                                                : 'bg-gray-600'
                                                        }`}
                                                    >
                                                        {threadId}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Right: Physical View (GPU) */}
                        <div className="bg-gray-800 rounded-xl p-4 border-2 border-green-500 shadow-lg">
                            <div className="flex items-center gap-2 mb-3">
                                <Zap className="w-6 h-6 text-green-400" />
                                <h2 className="text-xl font-bold text-green-400">Physical View: GPU Hardware</h2>
                            </div>

                            <div className="space-y-3">
                                {[...Array(NUM_SMS)].map((_, smId) => {
                                    const assignedBlocks = [...Array(NUM_BLOCKS)]
                                        .map((_, i) => i)
                                        .filter(blockId => getBlockAssignment(blockId) === smId);
                                    
                                    const color = smColors[smId];

                                    return (
                                        <div 
                                            key={smId}
                                            className={`bg-gray-700 rounded-lg p-3 border-2 ${color.border} transition-all duration-500`}
                                            style={{
                                                boxShadow: assignedBlocks.length > 0 && step >= 2 
                                                    ? `0 0 20px ${color.glow}` 
                                                    : 'none'
                                            }}
                                        >
                                            <div className="flex items-center justify-between mb-2">
                                                <span className="font-bold text-base">SM {smId}</span>
                                                <span className="text-xs bg-gray-600 px-2 py-1 rounded">
                                                    {assignedBlocks.length} block{assignedBlocks.length !== 1 ? 's' : ''}
                                                </span>
                                            </div>

                                            {/* Show assigned blocks */}
                                            {step >= 2 && assignedBlocks.length > 0 && (
                                                <div className="mb-2 flex gap-1 flex-wrap">
                                                    {assignedBlocks.map(blockId => (
                                                        <span 
                                                            key={blockId}
                                                            className={`text-xs ${color.bgDark} px-2 py-1 rounded animate-pulse`}
                                                        >
                                                            B{blockId}
                                                        </span>
                                                    ))}
                                                </div>
                                            )}

                                            {/* CUDA Cores */}
                                            <div className="grid grid-cols-8 gap-1">
                                                {[...Array(CORES_PER_SM)].map((_, coreId) => {
                                                    const isActive = step >= 4 && assignedBlocks.length > 0;
                                                    return (
                                                        <div
                                                            key={coreId}
                                                            className={`h-7 rounded flex items-center justify-center text-xs font-bold transition-all duration-300 ${
                                                                isActive
                                                                    ? `${color.bg} animate-pulse`
                                                                    : 'bg-gray-600'
                                                            }`}
                                                        >
                                                            {isActive ? '‚ö°' : coreId}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                            
                                            <div className="text-xs text-gray-400 mt-1 text-center">
                                                {CORES_PER_SM} CUDA Cores
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>

                            <div className="mt-3 bg-gray-900 rounded-lg p-2 text-xs">
                                <div className="text-yellow-400 font-bold mb-1">Key Insight:</div>
                                <div className="text-gray-300">
                                    {step >= 2 && (
                                        <>
                                            ‚Ä¢ Blocks distributed across {NUM_SMS} SMs by hardware scheduler<br/>
                                            ‚Ä¢ Each SM executes assigned blocks in parallel<br/>
                                            ‚Ä¢ Threads within a block run on SM's CUDA cores
                                        </>
                                    )}
                                    {step < 2 && (
                                        <>
                                            ‚Ä¢ GPU has {NUM_SMS} Streaming Multiprocessors (SMs)<br/>
                                            ‚Ä¢ Each SM has {CORES_PER_SM} CUDA cores<br/>
                                            ‚Ä¢ Waiting for blocks to be assigned...
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Controls */}
                    <div className="bg-gray-800 rounded-xl p-4 mt-4 border-2 border-gray-700 shadow-lg">
                        <div className="flex flex-col lg:flex-row items-center justify-between gap-4">
                            <div className="flex gap-3">
                                <button
                                    onClick={prevStep}
                                    disabled={step === 0}
                                    className="flex items-center gap-2 px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-bold transition-colors shadow-lg"
                                >
                                    <ChevronLeft className="w-5 h-5" />
                                    Previous Step
                                </button>
                                
                                <button
                                    onClick={nextStep}
                                    disabled={step === steps.length - 1}
                                    className="flex items-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-bold transition-colors shadow-lg"
                                >
                                    Next Step
                                    <ChevronRight className="w-5 h-5" />
                                </button>

                                <button
                                    onClick={reset}
                                    className="flex items-center gap-2 px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-bold transition-colors shadow-lg"
                                >
                                    <RotateCcw className="w-5 h-5" />
                                    Reset
                                </button>
                            </div>

                            {/* Progress bar */}
                            <div className="flex-1 w-full lg:w-auto lg:mx-6">
                                <div className="bg-gray-700 rounded-full h-3 overflow-hidden">
                                    <div 
                                        className="bg-gradient-to-r from-blue-500 to-green-500 h-full transition-all duration-500"
                                        style={{ width: `${((step + 1) / steps.length) * 100}%` }}
                                    />
                                </div>
                            </div>

                            <div className="text-lg font-bold text-gray-300">
                                Step {step + 1} / {steps.length}
                            </div>
                        </div>
                        
                        <div className="mt-3 text-center text-gray-400 text-sm">
                            üí° Use the stepper buttons to manually walk through each stage of GPU kernel execution
                        </div>
                    </div>

                    {/* Legend */}
                    <div className="mt-4 grid grid-cols-2 lg:grid-cols-4 gap-3">
                        <div className="bg-gray-800 rounded-lg p-2 border border-purple-500">
                            <div className="text-xs text-purple-400 font-bold mb-1">LOGICAL</div>
                            <div className="text-xs text-gray-300">Blocks & Threads (Your Code)</div>
                        </div>
                        <div className="bg-gray-800 rounded-lg p-2 border border-green-500">
                            <div className="text-xs text-green-400 font-bold mb-1">PHYSICAL</div>
                            <div className="text-xs text-gray-300">SMs & CUDA Cores (Hardware)</div>
                        </div>
                        <div className="bg-gray-800 rounded-lg p-2 border border-blue-500">
                            <div className="text-xs text-blue-400 font-bold mb-1">SCHEDULING</div>
                            <div className="text-xs text-gray-300">Runtime assigns blocks to SMs</div>
                        </div>
                        <div className="bg-gray-800 rounded-lg p-2 border border-yellow-500">
                            <div className="text-xs text-yellow-400 font-bold mb-1">PARALLEL</div>
                            <div className="text-xs text-gray-300">All SMs execute simultaneously</div>
                        </div>
                    </div>
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GPUSchedulingAnimation />);
    </script>
</body>
</html>